$fileDate = (Get-Date -Format yyyy-MM-ddTHH-mm-ss )
$fileName = "CVE-2022-30190backup" + "_" + "$fileDate" + ".reg"
$path = "c:\programdata\"
$outPath = "$path" + "$fileName"

New-PSDrive -PSProvider registry -Root HKEY_CLASSES_ROOT -Name HKCR
If ( Test-Path -Path "HKCR:\ms-msdt" ) {
    reg export HKEY_CLASSES_ROOT\ms-msdt "$outPath"
}
Else {
    Write-Output "HKEY_CLASSES_ROOT\ms-msdt does not exist"
    Exit 0
}

If ( Test-Path -Path "$outPath" ) {
    reg delete HKEY_CLASSES_ROOT\ms-msdt /f
    If ( Test-Path -Path "HKCR:\ms-msdt" ) {
        Write-Output "Reg key has been removed"
        Exit 0
    }
    Else {
        Write-Error "HKEY_CLASSES_ROOT\ms-msdt still exists, aborting"
        Exit 1
    }
}
Else {
    Write-Error "Couldn't find backup, aborting"
    Exit 1
}
